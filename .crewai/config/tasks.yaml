analyze_commit_changes:
  description: >
    Analyze commit {commit_sha} in repository {repository} (PR #{pr_number}).

    Focus on: diff content (lines added/removed), new files, removed files.
    Evaluate: code style, readability, test coverage, documentation. Assess
    commit message: does it clearly explain what and why?

    Use the CommitDiffTool with commit_sha="{commit_sha}" and
    repository="{repository}". Provide specific line references from the diff.
  expected_output: >
    A structured report with: - Commit message assessment (clear/unclear,
    follows conventions) - Files changed breakdown (new, modified, removed) -
    Code quality issues by file (severity: high/medium/low) - Missing tests for
    new functionality - Documentation gaps - Specific recommendations with line
    numbers
  agent: code_quality_reviewer

security_performance_review:
  description: >
    Review commit {commit_sha} in repository {repository} for security and
    performance issues.

    Focus on lines added (new attack surface) and removed (breaking changes).
    Check for: SQL injection, XSS, auth bypasses, hardcoded secrets, N+1
    queries, memory leaks, inefficient algorithms.

    Use the CommitDiffTool with commit_sha="{commit_sha}" and
    repository="{repository}". Flag CRITICAL issues that block merge.
  expected_output: >
    A report with: - Security vulnerabilities (CRITICAL/HIGH/MEDIUM) with CVE
    references - Performance bottlenecks with estimated impact - Hardcoded
    secrets or credentials (immediate block) - Remediation steps for each issue
  agent: security_performance_analyst

find_related_files:
  description: >
    Identify files functionally or logically related to changed files in commit
    {commit_sha} of repository {repository}, even if NOT modified in this
    commit.

    Analyze: imports, dependencies, shared patterns, architectural layers. This
    finds hidden impacts not visible in the commit diff.

    Use RelatedFilesTool to discover related files based on the changed files
    from the commit.
  expected_output: >
    A list of related files with: - File path - Relationship type (imports,
    imported by, shared dependency, pattern) - Relatedness score (0-100) - Why
    it's related and potential impact
  agent: architecture_impact_analyst

analyze_related_files:
  description: >
    Analyze the related files identified in the previous task for repository
    {repository}. Assess potential impacts of commit {commit_sha}'s changes on
    those files.

    Consider: breaking changes, interface modifications, shared contracts. Use
    FileContentTool to read related files and analyze their dependencies.
  expected_output: >
    An impact assessment with: - Affected components and their criticality -
    Potential breaking changes (with migration steps) - Integration risks (API
    changes, data format changes) - Recommendations for additional testing
  agent: architecture_impact_analyst

architecture_review:
  description: >
    Evaluate architectural implications of commit {commit_sha} in repository
    {repository}.

    Consider: design patterns, SOLID principles, coupling, cohesion,
    scalability, and alignment with existing architecture.

    Reference insights from all previous tasks to provide holistic view.
  expected_output: >
    An architectural assessment with: - Design pattern evaluation
    (appropriate/inappropriate) - Coupling and cohesion analysis - Scalability
    considerations (will this scale?) - Alignment with project architecture
    (consistent/divergent) - Long-term maintainability impact (tech debt
    introduced/reduced)
  agent: architecture_impact_analyst

generate_executive_summary:
  description: >
    === YOUR ROLE: SYNTHESIZER ONLY ===

    You are the Executive Summary Agent. Your ONLY job is to read the findings 
    from the 5 previous tasks and write a markdown summary. That's it.

    YOU DO NOT HAVE ACCESS TO ANY TOOLS. YOU CANNOT call CommitDiffTool,
    FileContentTool, or any other tool. YOU CANNOT fetch data from GitHub. YOU
    CANNOT access the repository.

    ALL THE DATA YOU NEED is already in your context from previous tasks:
    - Task 1 (Code Quality): Code review findings
    - Task 2 (Security): Security and performance issues
    - Task 3 (Related Files): List of related files
    - Task 4 (Impact): Impact assessment
    - Task 5 (Architecture): Architecture review

    YOUR TASK: Read the findings above and synthesize them into ONE cohesive
    markdown report that renders beautifully on GitHub.

    === GITHUB MARKDOWN FORMATTING RULES ===

    CRITICAL: DO NOT wrap your entire output in a code block (no ```markdown)!
    Your output should be DIRECT markdown that GitHub will render.

    Use these GitHub-flavored markdown elements:

    1. HEADINGS: Use ## for main sections, ### for subsections
       CORRECT: ## ðŸ“Š Executive Summary
       WRONG: # Executive Summary (too big) or #### (too small)

    2. EMPHASIS:
       - Bold: **text** for important items
       - Italic: *text* for subtle emphasis
       - DO NOT use <b> or <i> HTML tags

    3. LISTS:
       - Numbered: 1. Item one\n2. Item two
       - Bullets: - Item or * Item
       - Nested: Indent with 2 spaces

    4. CODE:
       - Inline code: `variable` or `function()`
       - Code blocks: Only for actual code snippets (3+ lines)
       - DO NOT wrap your entire summary in code blocks!

    5. HORIZONTAL RULES: Use --- on its own line

    6. LINKS: [Text](https://url)

    7. EMOJIS: Use Unicode emojis (âœ… ðŸš¨ âš ï¸ ðŸ’¡ ðŸ“Š)

    === EXACT OUTPUT STRUCTURE ===

    Write your output EXACTLY like this (NO code block wrapper):

    ## ðŸ“Š Executive Summary for Commit {commit_sha}

    [Write 4-5 sentences here: overall assessment, key metrics, recommendation]

    **Top 3 Actions:**
    1. [Most important action from findings]
    2. [Second most important action]
    3. [Third most important action]

    ---

    ## ðŸš¨ Critical Issues (Must Fix Before Merge)

    [If critical issues found in Tasks 1-2, list them here with details]
    [If none, write: "None found âœ…"]

    ---

    ## âš ï¸ Warnings (Should Fix Soon)

    [List medium-priority warnings from Tasks 1-5]
    [If none, write: "None found âœ…"]

    ---

    ## ðŸ’¡ Suggestions (Nice to Have)

    [List improvement suggestions from Tasks 1-5]
    [If none, write: "Code follows best practices âœ…"]

    ---

    ## âœ… Positive Observations

    [List good patterns, clean code, smart decisions from all tasks]

    ---

    ### ðŸ”— Quick Links
    - [View Commit](https://github.com/{repository}/commit/{commit_sha})
    - [View Pull Request](https://github.com/{repository}/pull/{pr_number})

    === FORMATTING EXAMPLES ===

    âœ… CORRECT:
    ## ðŸš¨ Critical Issues
    
    **Security Issue in `main.py:42`**
    - SQL injection vulnerability detected
    - Use parameterized queries instead
    
    âŒ WRONG:
    ```
    Critical Issues:
    Security Issue in main.py:42
    SQL injection vulnerability
    ```
    (Don't wrap in code blocks!)

    âœ… CORRECT:
    **Files Changed:** 3 files modified, 120 lines added
    
    âŒ WRONG:
    Files Changed: 3 files modified, 120 lines added
    (Use bold for metrics!)

    === IMPORTANT REMINDERS ===

    1. DO NOT wrap your output in ```markdown code blocks
    2. DO NOT try to fetch more data or call tools
    3. DO NOT say "I'll analyze" - just synthesize NOW
    4. DO use proper markdown headings (##), lists, bold
    5. DO include emojis for visual clarity
    6. DO make it scannable with clear sections
    7. DO write in complete, professional sentences

    Your output will be posted to GitHub Actions summary and PR comments.
    It MUST render as beautiful, formatted markdown, NOT plain text in a code box!
  expected_output: >
    Complete GitHub-flavored markdown executive summary that renders properly:
    - Clear heading hierarchy (##, ###)
    - Proper emphasis (bold, italic)
    - Clean lists (numbered and bulleted)
    - Inline code for file/function names
    - Code blocks ONLY for actual code snippets (3+ lines)
    - Horizontal rules for section breaks
    - Working links to commit and PR
    - Emojis for visual clarity
    - NO wrapper code blocks around the entire output

    The output will render beautifully on GitHub Actions summary page.
  agent: executive_summary_agent
