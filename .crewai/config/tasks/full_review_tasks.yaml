full_technical_review:
  description: >
    Perform comprehensive technical review focusing on architecture, design
    patterns, and code quality.

    WORKSPACE INPUTS (already cached - do NOT re-fetch): - diff.txt: Full commit
    diff (fetched once by router) - quick_review.json: Quick review findings
    (build on this) - ci_summary.json: CI context - commits.json: Commit history

    YOUR TASKS: 1. Use WorkspaceTool to read diff (do NOT use CommitDiffTool
    again) 2. Read quick_review.json to see what was already flagged 3. Perform
    deep analysis on:
       - Architecture decisions and patterns
       - Design quality (SOLID, DRY, separation of concerns)
       - Error handling and edge cases
       - Performance implications (algorithmic complexity, caching)
       - Maintainability (naming, structure, documentation)
       - Testing coverage (are new features tested?)
       - Security patterns (input validation, auth, secrets)

    FOCUS ON: - High-impact architectural issues - Design improvements that
    affect multiple files - Advanced patterns (dependency injection, state
    management) - Performance bottlenecks - Security vulnerabilities

    AVOID DUPLICATING: - Code style issues (already in quick_review.json) - CI
    errors (already in ci_summary.json) - Simple fixes (focus on systemic
    improvements)

    OUTPUT FORMAT: Use WorkspaceTool to write JSON to full_review.json: {
      "architecture": [
        {
          "category": "design_pattern",
          "severity": "warning",
          "file": "src/services/auth.ts",
          "title": "Tight coupling between auth and database layers",
          "description": "Auth service directly imports DB models, making
    testing difficult",
          "suggestion": "Inject repository interface to enable mocking and
    separation",
          "impact": "high"
        }
      ],
      "security": [
        {
          "category": "input_validation",
          "severity": "critical",
          "file": "src/api/users.ts",
          "title": "Missing input sanitization on user endpoints",
          "description": "User input passed directly to SQL query without
    validation",
          "suggestion": "Use parameterized queries or ORM to prevent SQL
    injection",
          "impact": "critical"
        }
      ],
      "performance": [],
      "testing": [
        {
          "category": "coverage",
          "severity": "info",
          "file": "src/utils/parser.ts",
          "title": "New parser utility lacks unit tests",
          "description": "Complex parsing logic added without test coverage",
          "suggestion": "Add tests covering edge cases (empty input, malformed
    data)",
          "impact": "medium"
        }
      ],
      "maintainability": [],
      "summary": "1 critical security issue, 1 architectural warning, testing
    gap identified"
    }

  expected_output: >
    Comprehensive technical review saved to full_review.json with: -
    Architectural analysis (patterns, coupling, design quality) - Security
    review (vulnerabilities, auth patterns, input validation) - Performance
    considerations (complexity, caching opportunities) - Testing gaps (missing
    tests for new features) - Maintainability assessment (naming, structure,
    docs) - Focus on high-impact systemic improvements (NOT style/lint issues)

security_deep_dive:
  description: >
    Specialized security analysis focusing on vulnerabilities and attack
    vectors.

    WORKSPACE INPUTS: - diff.txt: Focus on lines added (new attack surface) -
    quick_review.json: Basic security flags from quick review -
    full_review.json: General security patterns

    YOUR TASKS: 1. Read diff to identify security-sensitive changes 2. Perform
    OWASP Top 10 analysis:
       - Injection (SQL, NoSQL, command injection)
       - Broken authentication (weak passwords, session issues)
       - Sensitive data exposure (logs, error messages, env vars)
       - XML External Entities (XXE)
       - Broken access control (missing auth checks)
       - Security misconfiguration (debug mode, default creds)
       - Cross-Site Scripting (XSS)
       - Insecure deserialization
       - Using components with known vulnerabilities
       - Insufficient logging & monitoring
    3. Check for:
       - Hardcoded secrets (API keys, passwords, tokens)
       - Unsafe dependencies (known CVEs)
       - Missing rate limiting on API endpoints
       - Inadequate input validation
       - Insufficient error handling (info leakage)

    OUTPUT FORMAT: Use WorkspaceTool to write JSON to security_review.json: {
      "critical_vulnerabilities": [],
      "warnings": [],
      "recommendations": [],
      "owasp_categories": ["injection", "auth"],
      "summary": "No critical vulnerabilities found, 2 hardening
    recommendations"
    }

  expected_output: >
    Security analysis saved to security_review.json with OWASP-based findings
