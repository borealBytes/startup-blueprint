# Full review tasks - moved from root tasks.yaml
# These tasks run ONLY when crewai:full-review label is present

analyze_commit_changes:
  description: >
    Analyze commit changes with deep technical review.
    
    WORKSPACE INPUTS (already cached - do NOT re-fetch):
    - workspace/diff.txt: Full commit diff (fetched once by router)
    - workspace/quick_review.json: Quick review findings (build on this)
    - workspace/ci_summary.json: CI context
    - workspace/commits.json: Commit history
    
    Focus on DEEPER analysis than quick review:
    - Design patterns used (are they appropriate?)
    - SOLID principles adherence
    - Code complexity and maintainability
    - Test coverage for new functionality
    - API design quality
    - Documentation completeness
    
    Build on quick review findings - don't repeat basic issues.
    Use FileContentTool sparingly - prefer diff context.
    
  expected_output: >
    A structured report with:
    - Commit message assessment (clear/unclear, follows conventions)
    - Files changed breakdown (new, modified, removed)
    - Code quality issues by file (severity: high/medium/low)
    - Missing tests for new functionality
    - Documentation gaps
    - Specific recommendations with line numbers
  agent: code_quality_reviewer

security_performance_review:
  description: >
    Review commit for security and performance issues.
    
    WORKSPACE INPUTS:
    - workspace/diff.txt: Focus on lines added (new attack surface)
    - workspace/ci_summary.json: CI security checks
    
    Check for:
    - SQL injection vulnerabilities
    - XSS vulnerabilities
    - Authentication/authorization bypasses
    - Hardcoded secrets or credentials
    - N+1 query problems
    - Memory leaks
    - Inefficient algorithms
    - Missing input validation
    
    Flag CRITICAL issues that should block merge.
  
  expected_output: >
    A report with:
    - Security vulnerabilities (CRITICAL/HIGH/MEDIUM) with CVE references
    - Performance bottlenecks with estimated impact
    - Hardcoded secrets or credentials (immediate block)
    - Remediation steps for each issue
  agent: security_performance_analyst

find_related_files:
  description: >
    Identify files related to changed files (even if NOT modified in this commit).
    
    WORKSPACE INPUTS:
    - workspace/diff.txt: Changed files list
    
    Analyze:
    - Import relationships
    - Dependency graphs
    - Shared patterns
    - Architectural layers
    
    This finds hidden impacts not visible in the commit diff.
    Use RelatedFilesTool to discover related files.
  
  expected_output: >
    A list of related files with:
    - File path
    - Relationship type (imports, imported by, shared dependency)
    - Relatedness score (0-100)
    - Why it's related and potential impact
  agent: architecture_impact_analyst

analyze_related_files:
  description: >
    Analyze related files for potential impact of this commit's changes.
    
    WORKSPACE INPUTS:
    - workspace/diff.txt: What changed
    - Related files from previous task
    
    Assess:
    - Breaking changes to interfaces
    - Contract modifications
    - Shared data structure changes
    
    Use FileContentTool to read related files and analyze dependencies.
  
  expected_output: >
    An impact assessment with:
    - Affected components and their criticality
    - Potential breaking changes (with migration steps)
    - Integration risks (API changes, data format changes)
    - Recommendations for additional testing
  agent: architecture_impact_analyst

architecture_review:
  description: >
    Evaluate architectural implications of commit.
    
    WORKSPACE INPUTS:
    - workspace/diff.txt: Changes made
    - All previous task findings
    
    Consider:
    - Design patterns appropriateness
    - SOLID principles
    - Coupling and cohesion
    - Scalability implications
    - Alignment with existing architecture
    
    Reference insights from all previous tasks.
  
  expected_output: >
    An architectural assessment with:
    - Design pattern evaluation (appropriate/inappropriate)
    - Coupling and cohesion analysis
    - Scalability considerations (will this scale?)
    - Alignment with project architecture (consistent/divergent)
    - Long-term maintainability impact (tech debt introduced/reduced)
  agent: architecture_impact_analyst

generate_full_review_summary:
  description: >
    Synthesize findings from all 5 deep analysis tasks.
    
    WORKSPACE INPUTS:
    - All previous task outputs
    - workspace/router_decision.json: Router suggestions
    - workspace/ci_summary.json: CI results
    - workspace/quick_review.json: Quick review findings
    
    Create comprehensive markdown report following GitHub-flavored markdown.
    
    DO NOT wrap output in code blocks.
    Use proper markdown headings (##, ###), lists, bold, emojis.
  
  expected_output: >
    Complete GitHub-flavored markdown saved to workspace/full_review.json with:
    - Security findings
    - Architecture assessment
    - Related files impact
    - Performance considerations
    - Detailed recommendations
  agent: code_quality_reviewer
