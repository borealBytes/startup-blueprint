parse_and_contextualize:
  description: |
    Parse the diff and commit messages to create structured context for review.

    Steps:
    1. Read diff.txt using WorkspaceTool
    2. Read commits.json using WorkspaceTool
    3. Analyze changes and create diff_context.json using WorkspaceTool

    For diff sampling:
    - Small changes (<100 lines): include full diff
    - Medium changes (100-500 lines): sample based on commit keywords
    - Large changes (>500 lines): focus on high-risk files only

    Write the result to diff_context.json with this structure:
    {
      "commit_intent": "summary of changes",
      "total_changes": number,
      "changed_files": [
        {
          "path": "file/path",
          "type": "modified|added|deleted",
          "additions": number,
          "deletions": number,
          "risk_level": "high|medium|low"
        }
      ],
      "review_focus_areas": ["security", "database", "config"],
      "sampled_diff": "filtered diff content"
    }
  expected_output: |
    Confirmation that diff_context.json was created with parsed diff information

detect_code_issues:
  description: |
    Read diff_context.json and analyze the code for issues.

    Steps:
    1. Read diff_context.json using WorkspaceTool
    2. Analyze the sampled_diff for code issues:
       - Security issues (SQL injection, hardcoded secrets, etc.)
       - Performance issues (N+1 queries, nested loops, etc.)
       - Quality issues (magic numbers, error handling, etc.)
    3. Write findings to code_issues.json using WorkspaceTool

    Output structure for code_issues.json:
    {
      "critical": [{"file": "path", "line": number, "code_snippet": "...", "description": "..."}],
      "warnings": [{"file": "path", "line": number, "code_snippet": "...", "description": "..."}],
      "info": [{"file": "path", "line": number, "code_snippet": "...", "description": "..."}]
    }

    If no issues found, write empty arrays.
  expected_output: |
    Confirmation that code_issues.json was created with detected issues

synthesize_report:
  description: |
    Create the final quick_review.json by combining all findings.

    Steps:
    1. Read diff_context.json using WorkspaceTool
    2. Read code_issues.json using WorkspaceTool
    3. Synthesize findings and write to quick_review.json using WorkspaceTool

    Output structure for quick_review.json:
    {
      "status": "ok|warning|critical",
      "summary": "Detailed review summary (min 100 chars)",
      "total_findings": number,
      "critical": [{"file": "...", "line": number, "code_snippet": "...", "description": "...", "fix_suggestion": "..."}],
      "warnings": [{"file": "...", "line": number, "code_snippet": "...", "description": "...", "fix_suggestion": "..."}],
      "info": [{"file": "...", "line": number, "code_snippet": "...", "description": "..."}],
      "merge_status": "APPROVE|REQUEST_CHANGES|NEEDS_DISCUSSION",
      "merge_rationale": "Explanation of merge decision"
    }
  expected_output: |
    Confirmation that quick_review.json was created with complete review findings
