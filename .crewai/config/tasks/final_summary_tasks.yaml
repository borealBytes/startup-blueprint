synthesize_summary:
  description: >
    Synthesize all review outputs into a comprehensive GitHub-flavored markdown summary
    with ALL findings displayed in collapsible sections.

    **YOUR MISSION**: Create a detailed summary by reading workspace JSON files
    and extracting EVERY finding with full details (file paths, line numbers, fixes).

    **STEP-BY-STEP WORKFLOW**:

    1. **Read CI Summary** (REQUIRED):
       - Use WorkspaceTool: `operation="read", filename="ci_summary.json"`
       - Extract: `status`, `passed`, `summary`, `checks_performed`, `issue_analysis`
       - Extract ALL: `critical_errors`, `warnings` (not just counts)
       - Include full error messages and fix suggestions

    2. **Read Quick Review** (REQUIRED):
       - Use WorkspaceTool: `operation="read", filename="quick_review.json"`
       - Extract: `status`, `summary`
       - Extract ALL findings arrays:
         * `critical`: ALL critical issues (not just top 3)
         * `warnings`: ALL warnings
         * `info`: ALL suggestions
       - For EACH finding, extract:
         * `title`: Issue title
         * `file`: File path
         * `line`: Line number/range
         * `description`: What the problem is
         * `fix_suggestion`: How to fix it
         * `severity`: Severity level

    3. **Read Full Review** (if available):
       - Use WorkspaceTool: `operation="read", filename="full_review.json"`
       - Extract: `architecture`, `security`, `performance` findings
       - Filter for critical/high severity items

    4. **Read Router Decision**:
       - Use WorkspaceTool: `operation="read", filename="router_decision.json"`
       - Extract: `suggestions` array

    5. **Write comprehensive markdown with collapsible sections**:
       - Use WorkspaceTool: `operation="write", filename="final_summary.md"`

    **CRITICAL FORMATTING REQUIREMENTS**:

    - DO NOT summarize findings - show ALL of them
    - Use HTML <details> tags for collapsible sections
    - Critical issues: `<details open>` (expanded by default)
    - Warnings/Suggestions: `<details>` (collapsed by default)
    - Include severity emoji: üî¥ critical, üü° warning, üîµ info
    - Format each finding as:
      ```
      - üî¥ **Issue Title** `file.py:line_number`
        - Description of the problem
        - üí° **Fix**: Specific fix suggestion
      ```

    **EXAMPLE OUTPUT FORMAT**:

    ## ‚ö†Ô∏è Review Summary

    Review completed for PR #{pr_number} - {count} workflows executed.

    **Commit**: `{commit_sha}`
    **Repository**: {repository}
    **Workflows**: {workflows}
    **Timestamp**: {timestamp}

    ---

    ### ‚úÖ CI Analysis
    **Status**: ‚úÖ success
    **Checks Performed**: format, lint, type-check, test
    **Summary**: All CI checks passed successfully

    <details>
    <summary><b>üîç View CI Details</b></summary>

    **What Was Checked**:
    - Code formatting (Black, isort)
    - Linting (pylint, flake8)
    - Type checking (mypy)
    - Unit tests

    **Issue Analysis**:
    - Root Cause: [if any issues were found]
    - Fix Applied: [what was auto-fixed]
    - Recommendation: [if any]
    </details>

    ---

    ### ‚ö° Quick Review
    **Status**: completed
    **Summary**: [extract full summary from quick_review.json]

    **Findings**:
    - üî¥ 5 critical issue(s)
    - üü° 12 warning(s)
    - üîµ 6 suggestion(s)

    <details open>
    <summary><b>üî¥ Critical Issues (5)</b></summary>

    - üî¥ **Exception handling in main.py orchestrator lacks specificity** `.crewai/main.py:Multiple locations`
      - Broad exception catching in all workflow steps. Only logs errors but continues execution without proper cleanup. Could mask critical failures.
      - üí° **Fix**: Implement granular exception handling per step. Add retry logic for transient failures. Add validation that required files were actually created before proceeding.

    - üî¥ **Missing validation in WorkspaceTool.read_json()** `.crewai/tools/workspace_tool.py:134-139`
      - Returns empty dict on JSON decode error without logging what went wrong. Makes debugging difficult.
      - üí° **Fix**: Log the filename and specific JSON error. Return None or raise specific exception instead of silent failure.

    [... show ALL 5 critical issues ...]

    </details>

    <details>
    <summary><b>üü° Warnings (12)</b></summary>

    [... show ALL 12 warnings with same format ...]

    </details>

    <details>
    <summary><b>üîµ Suggestions (6)</b></summary>

    [... show ALL 6 suggestions with same format ...]

    </details>

    ---

    ### üîç Full Technical Review
    Status: [if exists, show findings; else "Did not run"]

    ---

    ### üí° Router Suggestions

    [Include suggestions from router_decision.json]

    ---

    *ü§ñ Generated by CrewAI Router System | ‚è±Ô∏è {timestamp}*

    **VALIDATION CHECKLIST** (verify before writing):
    ‚úì ALL critical issues shown (not just top 3)
    ‚úì ALL warnings shown (not just summary)
    ‚úì ALL suggestions shown
    ‚úì Each finding has: title, file:line, description, fix
    ‚úì Collapsible sections use correct HTML <details> syntax
    ‚úì Critical issues expanded by default (<details open>)
    ‚úì CI Analysis shows what was actually checked
    ‚úì No placeholder text without explanation

  expected_output: >
    Comprehensive GitHub-flavored markdown summary saved to final_summary.md with
    ALL findings displayed in collapsible HTML <details> sections. Each finding
    must include file path, line number, description, and fix suggestion.
    Critical issues expanded by default, warnings/suggestions collapsed.
    Total output should be as long as needed to show all findings (typically 200-500 lines).

  output_file: final_summary.md
