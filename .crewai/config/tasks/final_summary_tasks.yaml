synthesize_summary:
  description: >
    YOU MUST synthesize all review outputs into comprehensive GitHub markdown
    with ALL findings in collapsible HTML <details> sections.

    **CRITICAL**: This is NOT a summary task. You must show EVERY finding with
    full details. DO NOT abbreviate or skip findings.

    **EXECUTION STEPS** (follow exactly):

    1. **Read CI Summary**:
       ```
       WorkspaceTool(operation="read", filename="ci_summary.json", content="")
       ```
       - Extract `critical_errors` array (show ALL errors, not count)
       - Extract `warnings` array (show ALL warnings)  
       - Extract `summary`, `status`, `checks_performed`
       - If file missing/empty: note "CI analysis not available"

    2. **Read Quick Review** (MOST IMPORTANT):
       ```
       WorkspaceTool(operation="read", filename="quick_review.json", content="")
       ```
       - Extract arrays: `critical`, `warnings`, `info`
       - **YOU MUST iterate through EVERY item** in each array
       - For EACH item extract: `title`, `file`, `line`, `description`,
    `fix_suggestion`
       - Count totals but also SHOW each finding
       - If file missing/empty: note "Quick review not available"

    3. **Read Full Review** (if exists):
       ```
       WorkspaceTool(operation="read", filename="full_review.json", content="")
       ```
       - Extract high/critical severity findings only
       - If missing: note "Did not run"

    4. **Read Router Decision**:
       ```
       WorkspaceTool(operation="read", filename="router_decision.json", content="")
       ```
       - Extract `suggestions` array

    5. **Write Complete Markdown**:
       ```
       WorkspaceTool(operation="write", filename="final_summary.md", content="<markdown_here>")
       ```

    **OUTPUT FORMAT REQUIREMENTS**:

    Use this EXACT structure:

    ```markdown
    ## âš ï¸ Review Summary

    Review completed for PR #{pr_number} - {count} workflows executed.

    **Commit**: `{commit_sha}`  
    **Repository**: {repository}  
    **Workflows**: {workflows}  
    **Timestamp**: {timestamp}

    ---

    ### âœ… CI Analysis  
    **Status**: {emoji} {status}  
    **Summary**: {summary text}

    <details>
    <summary><b>ğŸ” View CI Issues</b></summary>

    **Critical Errors**:
    1. **{error.type}**: {error.message}
       - ğŸ’¡ **Fix**: {error.fix_suggestion}

    **Warnings**:
    1. {warning message}

    </details>

    ---

    ### âš¡ Quick Review  
    **Status**: {status}  
    **Summary**: {summary}

    **Findings**:  
    - ğŸ”´ {N} critical issue(s)  
    - ğŸŸ¡ {M} warning(s)  
    - ğŸ”µ {K} suggestion(s)

    <details open>
    <summary><b>ğŸ”´ Critical Issues ({N})</b></summary>

    - ğŸ”´ **{issue.title}** `{issue.file}:{issue.line}`
      - {issue.description}
      - ğŸ’¡ **Fix**: {issue.fix_suggestion}

    - ğŸ”´ **{next issue...}**
      ...

    </details>

    <details>
    <summary><b>ğŸŸ¡ Warnings ({M})</b></summary>

    - ğŸŸ¡ **{warning.title}** `{warning.file}:{warning.line}`
      - {warning.description}
      - ğŸ’¡ **Fix**: {warning.fix_suggestion}

    - ğŸŸ¡ **{next warning...}**
      ...

    </details>

    <details>
    <summary><b>ğŸ”µ Suggestions ({K})</b></summary>

    - ğŸ”µ **{info.title}** `{info.file}:{info.line}`
      - {info.description}
      - ğŸ’¡ **Fix**: {info.fix_suggestion}

    - ğŸ”µ **{next suggestion...}**
      ...

    </details>

    ---

    ### ğŸ” Full Technical Review  
    Status: {status or "Did not run"}

    [If ran, show critical findings with same format]

    ---

    ### ğŸ’¡ Router Suggestions

    - {suggestion 1}
    - {suggestion 2}

    ---

    *ğŸ¤– Generated by CrewAI Router System | â±ï¸ {timestamp}*
    ```

    **VALIDATION BEFORE WRITING**:
    âœ“ Counted `critical` array length from quick_review.json
    âœ“ Counted `warnings` array length  
    âœ“ Counted `info` array length  
    âœ“ Iterated through EACH item in EACH array  
    âœ“ Formatted each finding with title, file:line, description, fix  
    âœ“ Used `<details open>` for critical (expanded)  
    âœ“ Used `<details>` for warnings/suggestions (collapsed)  
    âœ“ Replaced ALL {placeholder} with actual data  
    âœ“ Final markdown is 1500+ characters (comprehensive)

    **COMMON MISTAKES TO AVOID**:
    âŒ Writing "5 critical issues found" without listing them
    âŒ Using placeholders like "show all critical issues" instead of actual list  
    âŒ Summarizing findings instead of showing each one  
    âŒ Forgetting to call WorkspaceTool("write", "final_summary.md", ...)  
    âŒ Writing markdown less than 1000 characters (means you skipped findings)

    **REMEMBER**: Your job is to format and display data, not summarize it. Read
    the JSON files and present EVERY finding in proper markdown format.

  expected_output: >
    Comprehensive GitHub-flavored markdown file saved as final_summary.md with
    minimum 1500 characters. Must contain ALL findings from quick_review.json
    displayed in collapsible <details> sections with title, file path, line
    number, description, and fix suggestion for EACH finding. Critical issues
    expanded by default, warnings/suggestions collapsed.

  output_file: final_summary.md
