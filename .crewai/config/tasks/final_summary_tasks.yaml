synthesize_summary:
  description: >
    **CRITICAL MISSION**: Create a comprehensive GitHub-flavored markdown
    summary by reading ALL workspace files and synthesizing their content.

    ## STEP-BY-STEP WORKFLOW

    ### Step 1: Read Router Decision Use WorkspaceTool(operation="read",
    filename="router_decision.json") Extract: workflows executed, suggestions

    ### Step 2: Read CI Analysis (REQUIRED) Use WorkspaceTool(operation="read",
    filename="ci_summary.json") Extract: - status (success/failure) -
    critical_errors array (type, message, severity, fix_suggestion) - warnings
    array - summary text - jobs_checked array

    ### Step 3: Read Quick Review Use WorkspaceTool(operation="read",
    filename="quick_review.json") If exists, extract: - status - key findings -
    recommendations If missing, note "Did not run"

    ### Step 4: Read Full Review (if available) Use
    WorkspaceTool(operation="read", filename="full_review.json") If exists,
    extract: - architecture issues array (category, severity, title,
    description, suggestion) - security issues array - performance issues array
    - testing issues array - maintainability issues array - summary text If
    missing, note "Did not run"

    ### Step 5: Read Security Review (if available) Use
    WorkspaceTool(operation="read", filename="security_review.json") If exists,
    extract: - critical_vulnerabilities array - warnings array - recommendations
    array - summary text If missing, skip section

    ### Step 6: Synthesize Markdown Create comprehensive summary following the
    EXACT format below.

    ### Step 7: Write Output Use WorkspaceTool(operation="write",
    filename="final_summary.md", content=<your complete markdown>)

    ## REQUIRED OUTPUT FORMAT

    (DO NOT wrap in code blocks - raw markdown only!)

    ## âš ï¸ Review Summary

    Review completed with [STATUS]. [One-sentence summary of key findings].

    **PR**: #{{pr_number}} **Commit**: `{{commit_sha}}` **Repository**:
    {{repository}} **Workflows Executed**: {{count}} workflows ([list workflow
    names from router_decision.json])

    ---

    ### âœ… CI Analysis

    **Status**: [success/failure from ci_summary.json]

    [IF FAILURES EXIST:] #### ðŸš¨ Critical Errors - **[error.type]**:
    [error.message] (Severity: [error.severity])
      - ðŸ’¡ Fix: [error.fix_suggestion]

    [REPEAT for each critical error]

    [IF WARNINGS EXIST:] #### âš ï¸ Warnings - [warning details]

    **Summary**: [ci_summary.summary]

    ---

    ### âš¡ Quick Review

    [IF quick_review.json exists:] **Status**: [status]

    **Key Findings**: - [finding 1] - [finding 2] - [finding 3]

    **Recommendations**: - [recommendation 1] - [recommendation 2]

    [IF missing:] Status: Did not run

    ---

    ### ðŸ” Full Technical Review

    [IF full_review.json exists:]

    #### Architecture Issues ([count]) - **[severity]** - [title]: [description]
      - ðŸ’¡ [suggestion]

    #### Security Vulnerabilities ([count]) - **[severity]** - [title]:
    [description]
      - ðŸ’¡ [suggestion]

    #### Performance Concerns ([count]) - **[severity]** - [title]:
    [description]

    #### Testing Gaps ([count]) - **[severity]** - [title]: [description]

    **Summary**: [full_review.summary]

    [IF missing:] Status: Did not run (no `crewai:full-review` label)

    ---

    ### ðŸ” Security Review

    [IF security_review.json exists:]

    #### Critical Vulnerabilities ([count]) - **[category]** - [title]:
    [description]
      - ðŸ’¡ Remediation: [remediation]

    **Summary**: [security_review.summary]

    [IF missing:] (Security review not requested)

    ---

    ### ðŸ¤– Router Suggestions

    [IF router_decision.suggestions exists and not empty:] - [suggestion 1] -
    [suggestion 2]

    [IF empty:] No additional suggestions from router.

    ---

    *ðŸ¤– Generated by CrewAI Router System | â±ï¸ {{timestamp}}*

    ## CRITICAL RULES

    1. **MUST READ ALL FILES**: Use WorkspaceTool to read every JSON file
    mentioned above 2. **MUST INCLUDE CONTENT**: Don't just say "CI failed" -
    include the actual error messages, suggestions, etc. 3. **NO CODE BLOCKS**:
    Output raw markdown, not wrapped in ```markdown 4. **BE SPECIFIC**: Extract
    actual data from JSON files, don't paraphrase or summarize too much 5.
    **HANDLE MISSING FILES**: If a file doesn't exist, note "Did not run" but
    continue 6. **LIMIT LENGTH**: Aim for 50-100 lines total, but don't omit
    critical details 7. **PRESERVE SEVERITY**: Always include severity levels
    (critical/high/medium/warning) 8. **INCLUDE FIX SUGGESTIONS**: These are the
    most valuable part for developers

  expected_output: >
    A comprehensive GitHub-flavored markdown summary (50-100 lines) written to
    final_summary.md via WorkspaceTool.

    MUST include: - Header with PR metadata - CI Analysis section with actual
    errors/warnings from ci_summary.json - Quick Review section with actual
    findings from quick_review.json - Full Review section with categorized
    issues from full_review.json (if exists) - Security Review section with
    vulnerabilities from security_review.json (if exists) - Router suggestions
    section - Footer with timestamp

    The summary should be actionable and detailed, not just a status update.
    Include actual error messages, fix suggestions, and severity levels.

  output_file: final_summary.md
