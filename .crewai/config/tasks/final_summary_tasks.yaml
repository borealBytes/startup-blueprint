synthesize_summary:
  description: >
    Synthesize all review outputs into a final GitHub-flavored markdown summary.

    CRITICAL INSTRUCTIONS: **FIRST**, check if critical workspace files exist
    using WorkspaceTool.exists(): - router_decision.json (REQUIRED) - diff.txt
    (REQUIRED - if missing, indicates router failed) - ci_summary.json
    (REQUIRED) - quick_review.json (REQUIRED) - full_review.json (optional -
    only if full-review ran)

    IF ANY REQUIRED FILE IS MISSING: Create a CRITICAL ERROR summary explaining
    which files are missing and what likely went wrong. Example: ## üö® CrewAI
    Review FAILED

    **Critical Error**: Review workflow did not complete successfully.

    ### Missing Files: - ‚ùå `diff.txt` - Router failed to fetch commit diff - ‚ùå
    `quick_review.json` - Quick review did not run

    ### Root Cause: The router agent failed to fetch the commit diff, which
    prevented all downstream reviews from running. Check the router crew logs
    for errors.

    ### Action Required: 1. Check GitHub Actions logs for the Router step 2.
    Verify `COMMIT_SHA` environment variable is set 3. Verify GitHub API
    credentials are valid

    **THEN STOP** - Do not attempt to create a normal summary.

    WORKSPACE INPUTS (read all that exist): - router_decision.json: Router
    suggestions and metadata - diff.txt: Commit diff (if missing = CRITICAL
    ERROR) - ci_summary.json: CI analysis results - quick_review.json: Quick
    code review findings - ci_correlation.json: CI issue correlations -
    full_review.json: Full technical review (if ran) - legal_review.json: Legal
    review (if ran - future) - commits.json: Commit history context

    YOUR TASK: Create ONE cohesive GitHub-flavored markdown report that
    synthesizes all findings into a scannable, actionable summary.

    GITHUB MARKDOWN FORMATTING RULES:

    CRITICAL: DO NOT wrap your entire output in a code block (no ```markdown).  
    Your output must be DIRECT markdown that GitHub will render beautifully.

    Use these GitHub-flavored markdown elements: 1. **HEADINGS**: Use `##` for
    main sections, `###` for subsections
       - CORRECT: `## Review Summary`
       - WRONG: `# Review Summary` (too big) or `#### Review Summary` (too
    small)

    2. **EMPHASIS**:
       - Bold: `**text**` for important items
       - Italic: `*text*` for subtle emphasis
       - DO NOT use `<b>` or `<i>` HTML tags

    3. **LISTS**:
       - Numbered: `1. Item one\n2. Item two`
       - Bullets: `- Item` or `* Item`
       - Nested: Indent with 2 spaces

    4. **CODE**:
       - Inline code: `` `variable` `` or `` `function()` ``
       - Code blocks: Only for actual code snippets (3+ lines)
       - DO NOT wrap your entire summary in code blocks!

    5. **HORIZONTAL RULES**: Use `---` on its own line

    6. **LINKS**: `[Text](URL)`

    7. **EMOJIS**: Use Unicode emojis (‚úÖ, ‚ùå, ‚ö†Ô∏è, üí°)

    STRUCTURE (adapt based on findings): ## üö® Status Summary or ‚úÖ Looks Good!
    or ‚ö†Ô∏è Minor Issues

    **Quick Take**: One sentence overall verdict with key numbers.

    **CI Status**: [Pass|Fail] - Brief summary from ci_summary.json

    **Review Highlights**: - Most important finding 1 - Most important finding 2
    - Most important finding 3

    --- ## üîç Detailed Findings

    ### Critical Issues (if any) **File**: `path/to/file.py` - **Issue**: Clear
    description - **Why**: Root cause analysis - **Fix**: Specific action to
    take

    ### Warnings (if any) Similar format, lower severity

    ### Suggestions (if any) Positive improvements or best practices

    --- ## ‚ú® What We Checked

    - CI Status (format, lint, build) - Quick Code Review (code quality,
    patterns) - [If ran] Full Technical Review - [If ran] Security Analysis

    --- *ü§ñ Generated by CrewAI Router System | ‚è±Ô∏è {{timestamp}}*

    SYNTHESIS RULES: - **Deduplicate**: If CI and code review flag the same
    issue, merge them - **Prioritize**: Critical issues first, then warnings,
    then suggestions - **Be Concise**: Each issue ‚â§ 3 sentences - **Be
    Actionable**: Every issue must have a "Fix" or "Action" - **Use Context**:
    Reference commit messages and PR metadata - **No Speculation**: Only report
    findings from workspace files

    TONE: - Direct and factual - Encouraging when appropriate - Never apologetic
    or uncertain - Use "we" for team perspective ("We found...", "We
    suggest...")

    OUTPUT FORMAT: Use WorkspaceTool to write markdown to final_summary.md (NOT
    in a code block!)

  expected_output: >
    A complete, GitHub-flavored markdown summary saved to final_summary.md that:
    - Starts with clear status emoji and verdict - Synthesizes all review
    findings into a scannable report - Deduplicates and prioritizes issues by
    severity - Provides actionable fix suggestions for every finding - Uses
    proper GitHub markdown (NOT wrapped in code blocks) - Ends with timestamp
    and review scope
