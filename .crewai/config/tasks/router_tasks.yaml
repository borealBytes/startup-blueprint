analyze_pr_and_route:
  description: |
    EXECUTE TOOL CALLS IN THIS ORDER:

    VALIDATION TOOLS:
    1. WorkspaceTool(operation="exists", filename="diff.json", content="")
    2. WorkspaceTool(operation="exists", filename="commits.json", content="")

    READ TOOLS:
    3. WorkspaceTool(operation="read", filename="diff.json", content="")
       Extract: pr_number, labels, files_changed, additions, deletions, file_list

    4. WorkspaceTool(operation="read", filename="commits.json", content="")
       Extract: commit_count, commit_messages

    WRITE TOOL:
    5. WorkspaceTool(operation="write", filename="router_decision.json", content={...})

    Required content for TOOL CALL 5:
    {
      "workflows": ["ci-log-analysis", "quick-review"],
      "suggestions": [],
      "metadata": {
        "pr_number": [from diff.json],
        "commit_sha": [from diff.json],
        "files_changed": [from diff.json],
        "lines_added": [additions from diff.json],
        "lines_removed": [deletions from diff.json],
        "complexity": "LOW|MEDIUM|HIGH"
      },
      "analysis": {
        "complexity": "LOW|MEDIUM|HIGH",
        "reason": "...",
        "file_types_detected": [],
        "security_files_detected": false,
        "validation_passed": true
      }
    }

    COMPLEXITY RULES:
    - LOW: files_changed < 5 AND (additions + deletions) < 100
    - MEDIUM: files_changed 5-20 OR lines 100-500
    - HIGH: files_changed > 20 OR (additions + deletions) > 500

    WORKFLOW RULES:
    - Always include: ["ci-log-analysis", "quick-review"]
    - If label "crewai:full-review" exists: add "full-review"
    - If label "crewai:legal" exists: add "legal-review"

    SUGGESTION RULES (add to suggestions array):
    - If complexity HIGH: "Consider adding crewai:full-review label"
    - If files match LICENSE*|TERMS*|CONTRIBUTING*: "Legal files detected - consider crewai:legal label"
    - If files match *secret*|*key*|*.env*|auth*: "Security-sensitive files - manual review recommended"

    RULES:
    - Make ALL tool calls BEFORE returning text
    - DO NOT explain what you will do
    - DO NOT return text between tool calls
    - DO NOT read diff.txt (causes token overflow)
    - workflows array MUST have at least 2 items

  expected_output: |
    Verify:
    1. Validated both input files exist
    2. Read diff.json and commits.json
    3. Wrote router_decision.json

    Return: "Routing complete: [N] workflows, complexity: [LEVEL]"
