analyze_pr_and_route:
  description: >
    Analyze the pull request and determine which review workflows to execute.

    YOU HAVE ACCESS TO: - PR metadata from PRMetadataTool (labels, files
    changed, LOC) - Commit diff via CommitDiffTool (fetch once, cache to
    workspace) - Commit history via CommitInfoTool (last 10 commits)

    YOUR TASKS: 1. Use PRMetadataTool to get PR labels and metadata (no API call
    - reads from environment) 2. Use CommitDiffTool to fetch the commit diff
    ONCE 3. Use WorkspaceTool to save diff to workspace/diff.txt for reuse by
    other agents 4. Use CommitInfoTool to get last 10 commits 5. Use
    WorkspaceTool to save commits to workspace/commits.json 6. Analyze changeset
    complexity (files, LOC, file types) 7. Decide which workflows should run
    based on labels 8. Suggest additional labels if appropriate

    WORKFLOW DECISION RULES: - ALWAYS include: ["ci-log-analysis",
    "quick-review"] (these are the default) - IF "crewai:full-review" label
    present â†’ add "full-review" to workflows - IF "crewai:legal" label present â†’
    add "legal-review" to workflows

    SUGGESTION RULES (suggest labels even if not present): - IF files_changed >
    20 OR lines_changed > 500 â†’ suggest "crewai:full-review" - IF legal files
    detected (LICENSE, TERMS, PRIVACY, CONTRIBUTING) â†’ suggest "crewai:legal" -
    IF security-sensitive files (.env, secrets, auth) â†’ warn immediately in
    suggestions - IF test files modified without code changes â†’ suggest testing
    review

    FILE TYPE DETECTION: - Legal: LICENSE*, TERMS*, PRIVACY*, CONTRIBUTING*,
    COPYRIGHT* - Security: .env*, *secret*, *key*, auth*, credential* - Config:
    *.yml, *.yaml, *.json, *.toml, Dockerfile* - Documentation: *.md, docs/*,
    README*

    OUTPUT FORMAT: Use WorkspaceTool to write JSON to
    workspace/router_decision.json: {
      "workflows": ["ci-log-analysis", "quick-review", "full-review"],
      "suggestions": [
        "ðŸ’¡ Large changeset (25 files) - crewai:full-review recommended",
        "âš ï¸ Legal files detected - consider crewai:legal label"
      ],
      "metadata": {
        "files_changed": 25,
        "lines_added": 450,
        "lines_removed": 120,
        "commit_count": 8,
        "file_types": {"python": 15, "yaml": 5, "markdown": 5}
      }
    }

  expected_output: >
    Complete routing decision saved to workspace/router_decision.json with: -
    List of workflows to execute - Intelligent suggestions for additional labels
    - PR metadata and analysis - Diff and commits cached to workspace for other
    agents
