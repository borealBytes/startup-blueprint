parse_ci_output:
  description: >
    Parse CI outputs from the core-ci job and identify errors/warnings with
    comprehensive details about what was checked and any issues found.

    INPUTS AVAILABLE: - CI job status from CIOutputParserTool (reads from
    environment) - Workspace diff from diff.txt (what files changed) - Workspace
    commits from commits.json (commit context)

    YOUR TASKS: 1. Use CIOutputParserTool to get CI job status and outputs

    2. Use WorkspaceTool to read diff.txt for context

    3. **EXTRACT WHAT WAS CHECKED**: Document which CI checks ran:
       - Code formatting (Black, Prettier, isort)
       - Linting (pylint, flake8, ESLint, Ruff)
       - Type checking (mypy, TypeScript)
       - Unit tests (pytest, jest)
       - Documentation link checking
       - Any other automated checks

    4. Parse and categorize CI issues by severity:
       - CRITICAL: Build failures, type errors, syntax errors (blocks merge)
       - WARNING: Lint warnings, format issues, style violations (should fix)
       - INFO: Documentation links, minor suggestions (nice to have)

    5. For each issue, extract:
       - Type (format error, lint error, type error, etc.)
       - File path and line number (if available)
       - Specific error message
       - Root cause analysis
       - Actionable fix suggestion

    6. Analyze if issues were auto-fixed:
       - Did format-and-lint job auto-commit fixes?
       - What was the before/after?
       - What still needs manual fixing?

    7. **RETURN JSON OUTPUT**: Your output will be automatically saved to ci_summary.json.
       Return this exact structure:
       {
         "status": "success",  # or "failure", "warning"
         "passed": true,
         "summary": "Core CI: all checks passed successfully",
         "checks_performed": [
           "code-formatting",
           "linting",
           "type-checking",
           "unit-tests",
           "link-checking"
         ],
         "critical_errors": [
           {
             "type": "Type Error",
             "file": "src/utils.ts",
             "line": "45",
             "message": "Type 'string' is not assignable to type 'number'",
             "fix_suggestion": "Change variable type or convert string to number"
           }
         ],
         "warnings": [
           {
             "type": "Lint Warning",
             "message": "Line too long (exceeds 100 chars)",
             "count": 3,
             "fix_suggestion": "Break long lines or adjust line length limit"
           }
         ],
         "issue_analysis": {
           "root_cause": "Recent refactor changed return types",
           "fix_applied": "Auto-formatted 15 files, fixed import order",
           "recommendation": "Review type definitions in changed files"
         }
       }

    IMPORTANT: - If CI passed, document what was checked and provide summary of
    success - If CI failed, extract specific error messages (use RAG if logs are
    large) - If issues were auto-fixed, explain what was fixed - Match errors to
    files in the diff for correlation - Keep context minimal - don't dump full
    logs - Include actionable recommendations

    ERROR CATEGORIZATION: - Format errors (Prettier, Black) → severity="warning"
    - Lint errors (ESLint, Ruff) → severity="warning" or "critical" if many -
    Type errors (TypeScript, mypy) → severity="critical" - Link check failures →
    severity="info" - Build failures → severity="critical" - Test failures →
    severity="critical"

  expected_output: >
    Complete CI analysis in JSON format with: - Overall CI status
    (success/warning/failure) - List of checks that were performed - Categorized
    list of all errors and warnings with file paths - Actionable fix suggestions
    for each issue - Issue analysis: root cause, what was auto-fixed,
    recommendations - Summary of what happened in CI (not just "success")

  output_json: ci_summary.json
